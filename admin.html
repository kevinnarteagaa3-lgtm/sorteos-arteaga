<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin ‚Äî Sorteos Arteaga</title>
<style>
  :root{--gold:#D4AF37;--bg:#050505;--panel:#0b0b0b;--muted:#aaa}
  body{background:var(--bg);color:#fff;font-family:Inter,Arial,sans-serif;margin:0;padding:18px}
  .wrap{max-width:980px;margin:18px auto}
  .card{background:linear-gradient(180deg,#0b0b0b,#111);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  h1{text-align:center;color:var(--gold);margin:0 0 12px 0}
  label{display:block;margin-top:10px;color:var(--gold);font-weight:700}
  input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid #222;background:#0d0d0d;color:#fff;margin-top:6px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1;min-width:180px}
  button.primary{background:var(--gold);color:#000;border:none;padding:12px;border-radius:10px;font-weight:800;cursor:pointer;margin-top:12px}
  .small{color:var(--muted);margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Panel Administraci√≥n ‚Äî Sorteos Arteaga</h1>

      <label>Logo (URL p√∫blica)</label>
      <input id="logo">

      <label>Fotos del carrusel (URLs separadas por coma)</label>
      <textarea id="fotos" placeholder="https://img1.jpg, https://img2.jpg"></textarea>

      <label>Descripci√≥n (aparece debajo del carrusel)</label>
      <textarea id="descripcion"></textarea>

      <div class="row">
        <div class="col">
          <label>WhatsApp (organizador) ‚Äî sin +</label>
          <input id="whatsapp" placeholder="5215635088487">
        </div>
        <div class="col">
          <label>Precio por boleto (MXN)</label>
          <input id="precio" type="number">
        </div>
      </div>

      <label>Promociones</label>
      <input id="promociones">

      <label>M√©todos de pago (cada m√©todo en nueva l√≠nea; ej. "Transferencia: BANCO 0123456789")</label>
      <textarea id="metodos_pago" placeholder="Transferencia: BANCO XXXX 0123456789 (Nombre...)&#10;OXXO: 1234567890 (Referencia)"></textarea>

      <div class="row">
        <div class="col">
          <label>N√∫mero total de emisiones (boletos)</label>
          <input id="emisiones" type="number" placeholder="Ej. 5000">
        </div>
        <div class="col">
          <label>Boletos vendidos/apartados (n√∫meros separados por coma)</label>
          <input id="boletos_vendidos" placeholder="Ej: 1,2,5,20">
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <button id="guardar" class="primary">üíæ Guardar cambios</button>
        <button id="reload" style="background:#333;color:#fff;border:none;padding:12px;border-radius:10px">‚Üª Recargar</button>
      </div>

      <div id="status" class="small">Cargando...</div>
      <p class="small">Si aparece "Error al guardar", revisa permisos de Apps Script o edita directamente la hoja (SorteosArteagaDatos).</p>
    </div>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzl8-sfJRysbmx8ohQbNbmG-1jt0zX15s5Foth6bordIO_JPkEVPks681EZBSEo_7hUtQ/exec";

async function load(){
  const st = document.getElementById('status'); st.textContent='Cargando...';
  try {
    const res = await fetch(SCRIPT_URL);
    const d = await res.json();
    document.getElementById('logo').value = d.logo || '';
    document.getElementById('fotos').value = d.fotos ? (Array.isArray(d.fotos)? d.fotos.join(', ') : d.fotos) : '';
    document.getElementById('descripcion').value = d.descripcion || '';
    document.getElementById('whatsapp').value = d.whatsapp || '';
    document.getElementById('precio').value = d.precio || '';
    document.getElementById('promociones').value = d.promociones || '';
    document.getElementById('metodos_pago').value = d.metodos_pago || '';
    document.getElementById('emisiones').value = d.emisiones || '';
    document.getElementById('boletos_vendidos').value = d.boletos_vendidos || '';
    st.textContent='‚úÖ Datos cargados';
  } catch (err) {
    console.error('load admin err',err);
    st.textContent='‚ö†Ô∏è No se pudo cargar (revisa URL/permisos)';
  }
}

document.getElementById('guardar').addEventListener('click', async ()=>{
  const st = document.getElementById('status'); st.textContent='Guardando...';
  const payload = {
    action: 'guardar',
    logo: document.getElementById('logo').value.trim(),
    fotos: document.getElementById('fotos').value.split(',').map(s=>s.trim()).filter(Boolean),
    descripcion: document.getElementById('descripcion').value.trim(),
    whatsapp: document.getElementById('whatsapp').value.trim(),
    precio: document.getElementById('precio').value,
    promociones: document.getElementById('promociones').value.trim(),
    metodos_pago: document.getElementById('metodos_pago').value.trim(),
    emisiones: Number(document.getElementById('emisiones').value) || 0,
    boletos_vendidos: document.getElementById('boletos_vendidos').value.trim()
  };
  try {
    const res = await fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    const txt = await res.text();
    st.textContent = '‚úÖ Guardado correctamente';
    setTimeout(()=> load(),700);
  } catch (err) {
    console.error('guardar err',err);
    st.textContent = '‚ùå Error al guardar (revisa permisos/URL)';
  }
});

document.getElementById('reload').addEventListener('click', load);

load();
</script>
</body>
</html>
