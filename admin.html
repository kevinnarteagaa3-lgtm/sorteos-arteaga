<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - Sorteos Arteaga</title>
<style>
  :root{--bg:#000;--accent:#FFD700}
  body{background:var(--bg);color:var(--accent);font-family:Arial;padding:18px}
  h1{ text-align:center }
  .card{background:#111;padding:12px;border-radius:10px;max-width:900px;margin:12px auto}
  input,textarea,select,button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none;background:#000;color:var(--accent)}
  input[type=file]{padding:6px}
  .preview{display:flex;gap:8px;flex-wrap:wrap}
  .preview img{width:120px;height:80px;object-fit:cover;border-radius:6px;border:2px solid #222}
  .tickets{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
  .ticket{padding:6px 8px;border-radius:6px;background:#fff;color:#000;cursor:pointer}
  .ticket.sold{background:#000;color:#fff}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .col{flex:1;min-width:200px}
  .note{font-size:13px;color:#999}
</style>
</head>
<body>
  <h1>‚öôÔ∏è Panel Admin ‚Äî Sorteos Arteaga</h1>

  <div class="card">
    <label>Logo (subir desde fototeca)</label>
    <input id="logoFile" type="file" accept="image/*">
    <div id="logoPreview" class="preview"></div>

    <label>Fotos del sorteo (subir varias)</label>
    <input id="photosFiles" type="file" accept="image/*" multiple>
    <div id="photosPreview" class="preview"></div>

    <label>T√≠tulo</label>
    <input id="titulo" type="text" placeholder="T√≠tulo del sorteo">

    <label>Descripci√≥n</label>
    <textarea id="descripcion" rows="3" placeholder="Detalles del sorteo"></textarea>

    <div class="row">
      <div class="col">
        <label>N√∫mero de emisiones (total de boletos)</label>
        <input id="emisiones" type="number" min="1" value="100">
      </div>
      <div class="col">
        <label>N√∫meros de WhatsApp (separados por coma)</label>
        <input id="whatsapp" type="text" placeholder="+52 56xxxxxxx">
      </div>
    </div>

    <label>M√©todos de pago</label>
    <textarea id="pagos" rows="2" placeholder="Tarjeta, OXXO, Transferencia..."></textarea>

    <div class="row">
      <div class="col">
        <label>Facebook</label>
        <input id="facebook" type="text" placeholder="https://facebook.com/...">
      </div>
      <div class="col">
        <label>Instagram</label>
        <input id="instagram" type="text" placeholder="https://instagram.com/...">
      </div>
    </div>

    <div style="margin-top:12px;">
      <button id="saveBtn">üíæ Guardar y sincronizar (Sheets + Drive)</button>
      <button id="genListBtn" style="background:#008f39;color:#fff;margin-left:8px">üîÅ Generar lista de boletos</button>
    </div>

    <p class="note">En "Generar lista" aparecer√°n los boletos para marcarlos como vendidos (negro). Luego guarda para enviar la configuraci√≥n a tu hoja.</p>
    <div id="ticketsArea" class="tickets"></div>
    <p class="note">Tickets marcados en negro = vendidos. Blanco = disponible. Naranja = apartado (no aplicado aqu√≠; apartados hacen los usuarios).</p>
  </div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzIi3yvzz0XIW42_wJEsoP0brcrqQs3sMq4xbjINjsTLY6EPSa1nEnP5zqEj589PUGvnA/exec";
let logoBase64 = "";
let photosBase64 = [];
let soldSet = new Set();

// previews
document.getElementById('logoFile').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  document.getElementById('logoPreview').innerHTML = '<img src="'+url+'">';
  const fr = new FileReader(); fr.onload=()=> logoBase64 = fr.result; fr.readAsDataURL(f);
});
document.getElementById('photosFiles').addEventListener('change', e=>{
  const files = Array.from(e.target.files);
  photosBase64 = [];
  const preview = document.getElementById('photosPreview'); preview.innerHTML='';
  files.forEach(f=>{
    const url = URL.createObjectURL(f);
    const img = document.createElement('img'); img.src=url; preview.appendChild(img);
    const fr = new FileReader(); fr.onload=()=> { photosBase64.push(fr.result); }; fr.readAsDataURL(f);
  });
});

// generar lista de boletos UI
document.getElementById('genListBtn').addEventListener('click', ()=>{
  const n = parseInt(document.getElementById('emisiones').value) || 100;
  const area = document.getElementById('ticketsArea'); area.innerHTML='';
  soldSet = new Set();
  for(let i=1;i<=n;i++){
    const d = document.createElement('div');
    d.className = 'ticket';
    d.textContent = i;
    d.dataset.num = i;
    d.onclick = ()=> {
      if(d.classList.contains('sold')) { d.classList.remove('sold'); soldSet.delete(d.dataset.num); d.style.background='#fff'; d.style.color='#000'; }
      else { d.classList.add('sold'); soldSet.add(d.dataset.num); d.style.background='#000'; d.style.color='#fff'; }
    };
    area.appendChild(d);
  }
});

// guardar y enviar a Apps Script
document.getElementById('saveBtn').addEventListener('click', async ()=>{
  const titulo = document.getElementById('titulo').value;
  const descripcion = document.getElementById('descripcion').value;
  const emisiones = document.getElementById('emisiones').value;
  const whatsapp = document.getElementById('whatsapp').value;
  const pagos = document.getElementById('pagos').value;
  const facebook = document.getElementById('facebook').value;
  const instagram = document.getElementById('instagram').value;

  const soldArray = Array.from(soldSet).map(x=>String(x)).sort((a,b)=>a-b);
  const payload = {
    titulo, descripcion, logo: logoBase64||"", photos: photosBase64||[], emisiones, pagos, facebook, instagram, whatsapp, soldNumbers: soldArray
  };

  try{
    const res = await fetch(scriptURL, {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const txt = await res.text();
    alert('‚úÖ Guardado en Sheets. Respuesta: ' + txt);
  }catch(e){
    alert('‚ùå Error al conectar con Sheets. Revisa permisos / URL del script.');
    console.error(e);
  }
});
</script>
</body>
</html>
