<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sorteos Arteaga â€” Participa y gana</title>
<style>
  :root{
    --gold:#D4AF37; --blue:#2196F3; --bg:#050506; --muted:#9b9b9b; --sold:#4b4b4b; --white:#fff;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--white);font-family:Inter,system-ui,Arial,sans-serif}
  header{padding:18px 12px;text-align:center}
  .logo-wrap{display:flex;flex-direction:column;align-items:center;gap:6px}
  .logo-wrap img{width:120px;height:120px;object-fit:cover;border-radius:14px;border:3px solid rgba(212,175,55,0.12);background:#0b0b0b}
  .site-title{font-size:22px;color:var(--gold);font-weight:800}
  .site-sub{font-size:13px;color:var(--muted)}
  main{max-width:1200px;margin:18px auto;padding:12px}
  .card{background:linear-gradient(180deg,#0b0b0b,#0f0f11);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);margin-top:12px}
  .carousel-row{display:flex;gap:10px;overflow:auto;padding:6px}
  .carousel-row img{height:140px;border-radius:10px;object-fit:cover}
  .methods{background:#06102a;color:var(--blue);padding:12px;border-radius:10px;font-weight:800;text-align:center}
  .promos{margin-top:8px;color:var(--gold);font-weight:800;text-align:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(64px,1fr));gap:8px;margin-top:12px}
  .num{padding:10px;border-radius:10px;text-align:center;font-weight:800;border:1px solid rgba(212,175,55,0.08);background:#070707;color:var(--gold);cursor:pointer;transition:transform .12s}
  .num:hover{transform:translateY(-6px)}
  .num.seleccionado{background:var(--gold);color:#000;box-shadow:0 10px 30px rgba(212,175,55,0.12)}
  .num.vendido{background:var(--sold);color:#111;cursor:not-allowed;border-color:#444}
  .floating{position:fixed;right:18px;bottom:18px;z-index:999;display:none}
  .floating button{padding:16px 24px;font-size:16px;border-radius:14px;background:#e53935;color:#fff;border:none;font-weight:800;cursor:pointer}
  .seleccionTxt{margin-top:12px;color:var(--gold);font-weight:700;text-align:center}
  .faq,.about{color:var(--muted);line-height:1.5}
  footer{margin-top:28px;padding:18px;text-align:center;color:var(--muted);font-size:13px}
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1000}
  .modal{width:92%;max-width:520px;background:#0c0c0c;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
  .modal h3{color:var(--gold);margin:0 0 10px 0;text-align:center}
  input,select,textarea{padding:10px;border-radius:8px;border:1px solid #222;background:#0a0a0a;color:#fff;width:100%;margin-top:8px}
  .row-flex{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:10px}
  @media (max-width:900px){ .grid{grid-template-columns:repeat(auto-fill,minmax(48px,1fr))} }
</style>
</head>
<body>
<header>
  <div class="logo-wrap">
    <img id="logo" src="" alt="Logo Sorteos Arteaga">
    <div class="site-title">Sorteos Arteaga</div>
    <div class="site-sub">Participa y gana</div>
  </div>
</header>

<main>
  <!-- CARRUSEL (ARRIBA) -->
  <div class="card" id="cardCarousel">
    <div id="carouselRow" class="carousel-row"></div>
  </div>

  <!-- DESCRIPCIÃ“N -->
  <div class="card">
    <div id="descripcion" class="about">Cargando descripciÃ³n...</div>
  </div>

  <!-- MÃ‰TODOS DE PAGO -->
  <div class="card">
    <div class="methods" id="methodsArea">Cargando mÃ©todos de pago...</div>
    <div id="promos" class="promos"></div>
  </div>

  <!-- MAQUINITA -->
  <div class="card" style="text-align:center">
    <h3 style="color:var(--gold);margin:0">ðŸŽ° Maquinita de la Suerte</h3>
    <div class="row-flex">
      <select id="maqOpt" style="width:160px">
        <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        <option value="4">4</option><option value="5">5</option><option value="10">10</option>
        <option value="15">15</option><option value="20">20</option><option value="50">50</option>
        <option value="100">100</option><option value="all">Todos</option>
      </select>
      <button id="btnGirar" style="background:var(--gold);color:#000;border:none;padding:10px 14px;border-radius:8px;font-weight:800;cursor:pointer">Girar</button>
      <button id="btnSelAll" style="background:#c9a531;color:#000;border:none;padding:10px 14px;border-radius:8px;font-weight:800;cursor:pointer">Seleccionar todos</button>
      <button id="btnLimpiar" style="background:#333;color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer">Limpiar</button>
    </div>
    <div id="maqResult" class="seleccionTxt"></div>
  </div>

  <!-- PROMOCIONES (separado arriba list) -->
  <div id="promotionsCard" class="card" style="display:none">
    <div style="font-weight:800;color:var(--gold)">Promociones</div>
    <div id="promosList" style="margin-top:8px;color:var(--white)"></div>
  </div>

  <!-- LISTA DE BOLETOS -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800">Lista de boletos</div>
      <div style="color:var(--muted);font-size:13px">Los gris estÃ¡n apartados â€” los dorados disponibles</div>
    </div>
    <div id="counter" style="margin-top:8px;color:var(--gold);font-weight:700"></div>
    <div id="grid" class="grid"></div>
    <div id="selectionText" class="seleccionTxt"></div>
  </div>

  <!-- FAQ / ABOUT -->
  <div class="card">
    <div style="font-weight:800;color:var(--gold)">Preguntas frecuentes</div>
    <div class="faq" style="margin-top:8px">
      <p><strong>Â¿CÃ³mo se elige a los ganadores?</strong> En base LoterÃ­a Nacional de MÃ©xico â€” transmisiones en vivo en Facebook e Instagram Sorteos Arteaga.</p>
      <p><strong>Â¿Puedo participar de cualquier parte?</strong> SÃ­, desde cualquier lugar de la RepÃºblica Mexicana y extranjero.</p>
      <p><strong>Â¿DÃ³nde se publican los ganadores?</strong> En nuestras pÃ¡ginas de Facebook e Instagram Sorteos Arteaga.</p>
      <p><strong>Â¿QuÃ© sucede si el ganador es boleto no vendido o no pagado?</strong> Se elige un nuevo ganador y se anuncia nueva fecha.</p>
    </div>
  </div>
</main>

<!-- Modal Apartar -->
<div id="modalBack" class="modal-back">
  <div class="modal">
    <h3>ðŸ“© Apartar boletos</h3>

    <label>NÃºmeros seleccionados</label>
    <input id="modalNums" readonly>

    <label>Nombre completo</label>
    <input id="modalNombre" placeholder="Ej. Juan PÃ©rez">

    <label>Estado</label>
    <select id="modalEstado">
      <option value="">Selecciona estado</option>
      <option>Aguascalientes</option><option>Baja California</option><option>Baja California Sur</option>
      <option>Campeche</option><option>Chiapas</option><option>Chihuahua</option><option>Ciudad de MÃ©xico</option>
      <option>Coahuila</option><option>Colima</option><option>Durango</option><option>Estado de MÃ©xico</option>
      <option>Guanajuato</option><option>Guerrero</option><option>Hidalgo</option><option>Jalisco</option>
      <option>MichoacÃ¡n</option><option>Morelos</option><option>Nayarit</option><option>Nuevo LeÃ³n</option>
      <option>Oaxaca</option><option>Puebla</option><option>QuerÃ©taro</option><option>Quintana Roo</option>
      <option>San Luis PotosÃ­</option><option>Sinaloa</option><option>Sonora</option><option>Tabasco</option>
      <option>Tamaulipas</option><option>Tlaxcala</option><option>Veracruz</option><option>YucatÃ¡n</option><option>Zacatecas</option>
    </select>

    <label>TelÃ©fono</label>
    <input id="modalTelefono" placeholder="Ej. 521XXXXXXXXXX">

    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="modalEnviar" style="background:#e53935;color:#fff;border:none;padding:12px;border-radius:10px;font-weight:800">Enviar y apartar</button>
      <button id="modalCerrar" style="background:#333;color:#fff;border:none;padding:12px;border-radius:10px">Cancelar</button>
    </div>
    <div id="modalMsg" style="margin-top:10px;color:var(--gold);font-weight:700"></div>
  </div>
</div>

<div class="floating" id="floatingBtn"><button id="btnFloating">ðŸ“© Apartar (0)</button></div>

<footer>
  Â© 2025 Sorteos Arteaga â€” Legalidad y transparencia (basados en LoterÃ­a Nacional)<br>
  <small style="color:var(--muted)">Â¿Dudas? WhatsApp: <strong id="footerWa">5635088487</strong></small>
</footer>

<script>
/*  CONFIG: pega aquÃ­ tu CSV pÃºblico y (opcional) tu Apps Script POST URL */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTXgIMoW1LvdfzyJsFX75DuMWdoNctr7FAexHUz_TTgSgaXWLB5v-WiaZ2De7nYoVRoiQwbFCQi4pIv/pub?gid=0&single=true&output=csv";
// si tienes un endpoint de Apps Script que acepta POST para guardar apartados, pÃ©galo aquÃ­ (opcional)
const SCRIPT_POST_URL = ""; // ejemplo: "https://script.google.com/macros/s/AKfy.../exec"
const ADMIN_WA = "5635088487";

let CONFIG = {}, vendidos = new Set(), seleccion = new Set();

const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* ----- CARGA DATOS DESDE SHEETS (CSV) ----- */
async function loadData(){
  try{
    const r = await fetch(CSV_URL);
    const text = await r.text();
    // CSV assumed rows: Tipo,Campo,Valor (ej: config,logo,https...)
    // We'll parse simply:
    const rows = text.trim().split("\n").map(r=>r.split(","));
    CONFIG = {};
    rows.forEach(c=>{
      if(c.length>=3 && c[0].toLowerCase().trim()==='config'){
        const campo = c[1].trim().toLowerCase();
        const valor = c.slice(2).join(",").trim();
        CONFIG[campo] = valor;
      }
    });
    // normalize
    CONFIG.imagenes = (CONFIG.imagenes||"").split(",").map(x=>x.trim()).filter(Boolean);
    CONFIG.metodos_pago = (CONFIG.metodos_pago||"").split("|").map(x=>x.trim()).filter(Boolean);
    CONFIG.promociones = CONFIG.promociones || "";
    vendidos = new Set((CONFIG.vendidos||"").toString().split(",").map(s=>s.trim()).filter(Boolean));
    renderAll();
  }catch(err){
    console.error(err);
    $('#descripcion').textContent = "No se pudieron cargar los datos. Revisa CSV_URL y permisos.";
  }
}

/* ----- RENDER ----- */
function renderAll(){
  // logo
  $('#logo').src = CONFIG.logo || "";
  // carousel
  const car = $('#carouselRow'); car.innerHTML = "";
  (CONFIG.imagenes||[]).forEach(src=>{ const i=document.createElement('img'); i.src=src; car.appendChild(i); });
  // description
  $('#descripcion').textContent = CONFIG.descripcion || "Sin descripciÃ³n disponible.";
  // methods
  const m = $('#methodsArea'); m.innerHTML = "";
  (CONFIG.metodos_pago || []).forEach(line=>{
    const div = document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center';
    const span = document.createElement('div'); span.textContent = line; span.style.color='#bfe6ff';
    const btn = document.createElement('button'); btn.className='copy-btn'; btn.textContent='Copiar';
    btn.onclick = ()=>{ navigator.clipboard.writeText(line); btn.textContent = 'Copiado'; setTimeout(()=>btn.textContent='Copiar',1200); };
    div.append(span,btn); m.appendChild(div);
  });
  // promos
  $('#promos').textContent = CONFIG.promociones || "";
  if((CONFIG.promociones||"").trim()) { $('#promotionsCard').style.display='block'; $('#promosList').textContent = CONFIG.promociones; }
  else $('#promotionsCard').style.display='none';
  $('#footerWa').textContent = CONFIG.whatsapp || ADMIN_WA;

  // boletos
  const total = Number(CONFIG.emisiones||0) || 0;
  $('#counter').textContent = `ðŸŽŸï¸ ${total} boletos â€” ${Math.max(0, total - (vendidos.size||0))} disponibles`;
  renderGrid(total);
}

/* ----- GRID ----- */
function padNum(i,total){ return i.toString().padStart(total>=10000?5:4,'0'); }
function renderGrid(total){
  const g = $('#grid'); g.innerHTML = "";
  for(let i=1;i<=total;i++){
    const label = padNum(i,total);
    const el = document.createElement('div'); el.className='num'; el.textContent = label;
    if(vendidos.has(label)) el.classList.add('vendido');
    else el.onclick = ()=> toggleSelect(el,label);
    g.appendChild(el);
  }
  updateUI();
}

function toggleSelect(el,label){
  if(el.classList.contains('vendido')) return;
  if(el.classList.contains('seleccionado')){ el.classList.remove('seleccionado'); seleccion.delete(label); }
  else { el.classList.add('seleccionado'); seleccion.add(label); }
  // show modal automatically when selecting numbers
  openModalIfSelection();
  updateUI();
}

function updateUI(){
  const arr = Array.from(seleccion).sort((a,b)=>Number(a)-Number(b));
  $('#selectionText').textContent = arr.length ? `Seleccionaste: ${arr.join(', ')}` : '';
  $('#btnFloating').textContent = `ðŸ“© Apartar (${arr.length})`;
  $('#floatingBtn').style.display = arr.length ? 'block' : 'none';
}

/* ----- MAQUINITA ----- */
$('#btnGirar').onclick = ()=>{
  const opt = $('#maqOpt').value;
  const avail = $$('.num:not(.vendido)').map(n=>n.textContent);
  let picks = [];
  if(opt==='all') picks = avail;
  else {
    const count = Math.min(Number(opt), avail.length);
    for(let i=0;i<count;i++){
      const idx = Math.floor(Math.random()*avail.length);
      picks.push(avail.splice(idx,1)[0]);
    }
  }
  seleccion = new Set(picks);
  $$('.num').forEach(n=> n.classList.toggle('seleccionado', seleccion.has(n.textContent)) );
  $('#maqResult').textContent = picks.length ? 'Generados: ' + picks.join(', ') : '';
  updateUI();
};

$('#btnSelAll').onclick = ()=>{
  seleccion = new Set($$('.num:not(.vendido)').map(n=>n.textContent));
  $$('.num').forEach(n=> n.classList.toggle('seleccionado', seleccion.has(n.textContent)) );
  updateUI();
};
$('#btnLimpiar').onclick = ()=>{
  seleccion.clear(); $$('.num.seleccionado').forEach(n=>n.classList.remove('seleccionado')); updateUI();
};

/* ----- MODAL / APARTAR ----- */
function openModalIfSelection(){
  const arr = Array.from(seleccion);
  if(arr.length>0){
    $('#modalNums').value = arr.join(', ');
    $('#modalBack').style.display = 'flex';
  }
}
$('#modalCerrar').onclick = ()=> $('#modalBack').style.display='none';

$('#modalEnviar').onclick = async ()=>{
  const nombre = $('#modalNombre').value.trim();
  const estado = $('#modalEstado').value.trim();
  const telefono = $('#modalTelefono').value.trim();
  const nums = $('#modalNums').value.trim();
  if(!nombre || !estado || !nums) return alert('Completa nombre, estado y nÃºmeros.');
  // WhatsApp
  const waMsg = `Hola Sorteos Arteaga, quiero apartar: ${nums}.%0ANombre: ${encodeURIComponent(nombre)}%0AEstado: ${encodeURIComponent(estado)}%0ATelÃ©fono: ${encodeURIComponent(telefono)}`;
  window.open(`https://wa.me/${CONFIG.whatsapp || ADMIN_WA}?text=${waMsg}`, '_blank');

  // Intentar guardar en Apps Script si estÃ¡ definido
  if(SCRIPT_POST_URL){
    try {
      const payload = { action:'apartar', nombre, estado, telefono, numeros: nums.split(',').map(s=>s.trim()), fecha: new Date().toISOString() };
      const resp = await fetch(SCRIPT_POST_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      const text = await resp.text();
      $('#modalMsg').textContent = 'âœ… Apartado guardado. ' + text;
      // refrescar datos despuÃ©s
      setTimeout(()=>{ seleccion.clear(); $$('.num.seleccionado').forEach(n=>n.classList.remove('seleccionado')); loadData(); $('#modalBack').style.display='none'; }, 900);
      return;
    } catch(err){
      console.error('POST error',err);
      $('#modalMsg').textContent = 'âš ï¸ No se pudo guardar en Sheets (revisa SCRIPT_POST_URL / permisos).';
    }
  } else {
    $('#modalMsg').textContent = 'âœ… WhatsApp abierto. (No hay SCRIPT_POST_URL configurado para guardar automÃ¡ticamente.)';
  }
  // limpia selecciÃ³n local
  seleccion.clear(); $$('.num.seleccionado').forEach(n=>n.classList.remove('seleccionado'));
  setTimeout(()=>{ $('#modalBack').style.display='none'; }, 700);
};

/* ----- floating apartar quick ----- */
$('#btnFloating').onclick = ()=> { openModalIfSelection(); };

/* ----- INIT ----- */
loadData();
</script>
</body>
</html>
