<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sorteos Arteaga üéüÔ∏è</title>
<style>
  :root {
    --gold: #D4AF37;
    --black: #000;
    --gray: #555;
    --bg: #111;
  }
  body {
    font-family: "Poppins", sans-serif;
    background: var(--bg);
    color: white;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  header {
    background: var(--black);
    padding: 15px;
    color: var(--gold);
    font-weight: bold;
    font-size: 1.2em;
  }
  .info {
    margin: 15px;
    font-size: 0.95em;
  }
  .contador {
    font-size: 1.1em;
    color: var(--gold);
    margin-bottom: 15px;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(55px, 1fr));
    gap: 8px;
    margin: 20px;
  }
  .num {
    border: 1px solid var(--gold);
    padding: 10px 0;
    background: #000;
    color: var(--gold);
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
  }
  .num:hover {
    background: var(--gold);
    color: #000;
  }
  .num.seleccionado {
    background: var(--gold);
    color: #000;
  }
  .num.vendido {
    background: var(--gray);
    color: #222;
    cursor: not-allowed;
  }
  button {
    background: var(--gold);
    color: black;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    margin: 15px auto;
    display: block;
  }
  button:hover {
    background: #c9a531;
  }
  .seleccion {
    margin-top: 15px;
    color: var(--gold);
  }
  .formulario {
    margin: 15px auto;
    max-width: 400px;
  }
  input, select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #333;
    margin: 6px 0;
  }
</style>
</head>
<body>
  <header>üéüÔ∏è Boletos en <span style="color:gray;">gris</span> est√°n apartados. Los dem√°s est√°n disponibles.</header>
  <div class="info" id="descripcion"></div>
  <div class="contador" id="contador"></div>

  <div class="grid" id="grid"></div>

  <div class="seleccion" id="seleccion"></div>

  <div class="formulario" id="formulario" style="display:none;">
    <input id="nombre" type="text" placeholder="Tu nombre completo">
    <select id="estado">
      <option value="">Selecciona tu estado</option>
      <option>Aguascalientes</option><option>Baja California</option><option>Baja California Sur</option>
      <option>Campeche</option><option>Chiapas</option><option>Chihuahua</option><option>Ciudad de M√©xico</option>
      <option>Coahuila</option><option>Colima</option><option>Durango</option><option>Estado de M√©xico</option>
      <option>Guanajuato</option><option>Guerrero</option><option>Hidalgo</option><option>Jalisco</option>
      <option>Michoac√°n</option><option>Morelos</option><option>Nayarit</option><option>Nuevo Le√≥n</option>
      <option>Oaxaca</option><option>Puebla</option><option>Quer√©taro</option><option>Quintana Roo</option>
      <option>San Luis Potos√≠</option><option>Sinaloa</option><option>Sonora</option><option>Tabasco</option>
      <option>Tamaulipas</option><option>Tlaxcala</option><option>Veracruz</option><option>Yucat√°n</option><option>Zacatecas</option>
    </select>
    <button id="btnApartar">üì© Apartar seleccionados</button>
  </div>

  <div style="margin:20px;">
    <label style="color:var(--gold);font-weight:bold;">üé∞ Maquinita de la Suerte:</label><br>
    <select id="cantidad">
      <option value="1">1 n√∫mero</option>
      <option value="2">2 n√∫meros</option>
      <option value="3">3 n√∫meros</option>
      <option value="4">4 n√∫meros</option>
      <option value="10">10 n√∫meros</option>
      <option value="100">100 n√∫meros</option>
    </select>
    <button id="btnMaquinita">üé≤ Generar</button>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzl8-sfJRysbmx8ohQbNbmG-1jt0zX15s5Foth6bordIO_JPkEVPks681EZBSEo_7hUtQ/exec";
let boletos = [], vendidos = [], seleccionados = [];

async function cargar() {
  const res = await fetch(SCRIPT_URL);
  const data = await res.json();
  const total = Number(data.emisiones) || 0;
  vendidos = (data.boletos_vendidos || "").split(",").map(x=>x.trim()).filter(Boolean);
  document.getElementById("descripcion").textContent = data.descripcion || "";
  document.getElementById("grid").innerHTML = "";
  const grid = document.getElementById("grid");
  for (let i=1; i<=total; i++) {
    let n = i.toString().padStart(total >= 10000 ? 5 : total >= 1000 ? 4 : 3, "0");
    const div = document.createElement("div");
    div.className = "num";
    div.textContent = n;
    if (vendidos.includes(n)) div.classList.add("vendido");
    div.onclick = () => toggleSeleccion(n, div);
    grid.appendChild(div);
  }
  actualizarContador(total);
}

function actualizarContador(total){
  const disp = total - vendidos.length;
  document.getElementById("contador").innerHTML = 
  `üí∞ <b>${total}</b> boletos totales ‚Äî <b>${disp}</b> disponibles`;
}

function toggleSeleccion(num, div){
  if(div.classList.contains("vendido")) return;
  div.classList.toggle("seleccionado");
  if(div.classList.contains("seleccionado")){
    seleccionados.push(num);
  } else {
    seleccionados = seleccionados.filter(n => n !== num);
  }
  document.getElementById("seleccion").innerHTML = 
  seleccionados.length ? `Seleccionaste: ${seleccionados.join(", ")}` : "";
  document.getElementById("formulario").style.display = seleccionados.length ? "block" : "none";
}

document.getElementById("btnMaquinita").onclick = ()=>{
  const cant = Number(document.getElementById("cantidad").value);
  const disponibles = [...document.querySelectorAll(".num:not(.vendido)")].map(d=>d.textContent);
  seleccionados = [];
  for(let i=0;i<cant && disponibles.length;i++){
    const random = disponibles.splice(Math.floor(Math.random()*disponibles.length),1)[0];
    seleccionados.push(random);
  }
  document.querySelectorAll(".num").forEach(d=>{
    d.classList.toggle("seleccionado", seleccionados.includes(d.textContent));
  });
  document.getElementById("seleccion").innerHTML = `Seleccionaste: ${seleccionados.join(", ")}`;
  document.getElementById("formulario").style.display = "block";
}

document.getElementById("btnApartar").onclick = ()=>{
  const nombre = document.getElementById("nombre").value.trim();
  const estado = document.getElementById("estado").value;
  if(!nombre || !estado || seleccionados.length===0) {
    alert("Completa tus datos y selecciona boletos.");
    return;
  }
  alert(`üì© ${nombre} (${estado}) apart√≥: ${seleccionados.join(", ")}`);
  location.reload();
};

cargar();
</script>
</body>
</html>
